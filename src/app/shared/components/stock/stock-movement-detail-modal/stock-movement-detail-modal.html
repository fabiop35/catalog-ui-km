<!-- File: stock-movement-detail-modal.html -->
<mat-card class="movement-detail-card">
  <mat-card-header>
    <mat-card-title>Detalle de Movimiento</mat-card-title>
    <!-- Removed product reference/code subtitle -->
    <!-- <mat-card-subtitle>{{ movement.productReference }} | {{ movement.productCode }}</mat-card-subtitle> -->
  </mat-card-header>
  <mat-card-content *ngIf="!loading">
    <div *ngIf="movement; else noMovement">
      <mat-list>
        <mat-list-item>
          <h4 mat-line>Producto</h4>
          <p mat-line>{{ movement.productName || movement.productId }}</p>
        </mat-list-item>
        <mat-list-item>
          <h4 mat-line>Ubicación</h4>
          <p mat-line>{{ movement.locationName || movement.locationId }}</p>
        </mat-list-item>
        <mat-list-item *ngIf="movement.attributeSetInstanceDescription">
          <h4 mat-line>Variante</h4>
          <p mat-line>{{ movement.attributeSetInstanceDescription }}</p>
        </mat-list-item>
        <mat-list-item>
          <h4 mat-line>Fecha</h4>
          <p mat-line>{{ formatDate(movement.date) }}</p>
        </mat-list-item>
        <mat-list-item>
          <h4 mat-line>Razón</h4>
          <p mat-line>
            <mat-chip [color]="getMovementClass(movement.reason).split('-')[1] || 'primary'">
              <mat-icon>{{ getReasonIcon(movement.reason) }}</mat-icon>
              {{ getReasonLabel(movement.reason) }}
            </mat-chip>
          </p>
        </mat-list-item>
        <mat-list-item>
          <h4 mat-line>Unidades</h4>
          <p mat-line [ngClass]="{ 'positive': movement.units >= 0, 'negative': movement.units < 0 }">
            {{ formatUnits(movement.units) }}
          </p>
        </mat-list-item>
        <mat-list-item>
          <h4 mat-line>Precio Unitario</h4>
          <p mat-line>{{ movement.price !== null ? (movement.price | currency:'COP':'symbol':'1.0-0') : 'N/A' }}</p>
        </mat-list-item>
        <mat-list-item>
          <h4 mat-line>Valor Total</h4>
          <!-- Use safe navigation operator (?.) and handle null price -->
          <p mat-line>{{ (movement.price !== null ? movement.units * movement.price : 0) |
            currency:'COP':'symbol':'1.0-0' }}</p>
        </mat-list-item>
        <mat-list-item *ngIf="movement.notes">
          <h4 mat-line>Notas</h4>
          <p mat-line>{{ movement.notes }}</p>
        </mat-list-item>
        <mat-list-item *ngIf="movement.userName">
          <h4 mat-line>Usuario</h4>
          <p mat-line>{{ movement.userName }}</p>
        </mat-list-item>
        <mat-list-item *ngIf="movement.supplierName && movement.supplierName !== 'N/A'">
          <h4 mat-line>Proveedor</h4>
          <p mat-line>{{ movement.supplierName }}</p>
        </mat-list-item>
        <mat-list-item *ngIf="movement.supplierDoc">
          <h4 mat-line>Documento Proveedor</h4>
          <p mat-line>{{ movement.supplierDoc }}</p>
        </mat-list-item>
      </mat-list>
    </div>
    <ng-template #noMovement>
      <p>No se encontraron detalles del movimiento.</p>
    </ng-template>
  </mat-card-content>

  <mat-card-content *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
  </mat-card-content>

  <mat-card-actions align="end">
    <button mat-button (click)="close()">Cerrar</button>
  </mat-card-actions>
</mat-card>